

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>            Configuring Model-Driven Telemetry (MDT) with YDK and XR Native YANG model      IOS XR Streaming Telemetry @xrdocs      </title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="IOS XR Streaming Telemetry @xrdocs">
<meta property="og:title" content="Configuring Model-Driven Telemetry (MDT) with YDK and XR Native YANG model">


  <link rel="canonical" href="http://localhost:4000/tutorials/2016-10-24-configuring-model-driven-telemetry-mdt-with-ydk-and-xr-native-yang-model/">
  <meta property="og:url" content="http://localhost:4000/tutorials/2016-10-24-configuring-model-driven-telemetry-mdt-with-ydk-and-xr-native-yang-model/">



  <meta property="og:description" content="Configuring Model-Driven Telemetry with YDK and XR Native YANG model">



  <meta name="twitter:site" content="@xrdocs">
  <meta name="twitter:title" content="Configuring Model-Driven Telemetry (MDT) with YDK and XR Native YANG model">
  <meta name="twitter:description" content="Configuring Model-Driven Telemetry with YDK and XR Native YANG model">
  <meta name="twitter:url" content="http://localhost:4000/tutorials/2016-10-24-configuring-model-driven-telemetry-mdt-with-ydk-and-xr-native-yang-model/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="http://localhost:4000/images/telemetry-xrdocs.jpg">
    
  

  
    <meta name="twitter:creator" content="@">
  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2016-10-24T05:39:00+00:00">
  
    <link rel="next" href="http://localhost:4000/tutorials/2016-12-23-streaming-bgp-route-and-neighbor-counts-with-mdt/" title="Streaming BGP Route and Neighbor Counts with MDT">
  
  
    <link rel="prev" href="http://localhost:4000/tutorials/2016-10-13-using-model-driven-telemetry-mdt-for-if-mib-data/" title="Using Model-Driven Telemetry (MDT) for IF-MIB Data">
  



  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "http://localhost:4000",
      "logo": "http://localhost:4000/images/telemetry-xrdocs.jpg"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "person",
      "name" : "Cisco Systems Inc",
      "url" : "http://localhost:4000",
      "sameAs" : ["https://twitter.com/CiscoDevNet"]
    }
  </script>






<!-- end SEO -->

<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="IOS XR Streaming Telemetry @xrdocs Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="jgRKKm6B9FwJJPXxpmc0-EP3D0Mh8JHXaJqoYIGj1ek" />

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<script>
if (!(window.location.host.startsWith("127.0.0.1") || window.location.host.startsWith("localhost")) && (window.location.host.substr(-10) == '.github.io') && (window.location.protocol != "https:"))
    window.location.protocol = "https";
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<meta http-equiv="cleartype" content="on">
<style>
.underline-on-hover:hover {
    text-decoration: underline;
}
.searchForm{
      border-radius:5px;
      -moz-border-radius:5px;
      -webkit-border-radius:5px;
      width: 900px;
   }
#search_results{
      display: table; margin:0 auto;
   }
</style>
</style>

    

<!-- start custom head snippets -->

<link href="http://localhost:4000/assets/css/lity.min.css" rel="stylesheet">
<link href="http://localhost:4000/assets/css/cisco-sans.min.css" rel="stylesheet">
<link href="http://localhost:4000/assets/css/material-scrolltop.css" rel="stylesheet">

<link rel="apple-touch-icon-precomposed" sizes="57x57" href="http://localhost:4000/images/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="http://localhost:4000/images/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://localhost:4000/images/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="http://localhost:4000/images/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://localhost:4000/images/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-128.png" sizes="128x128" />
<link rel="shortcut icon" href="http://localhost:4000/images/favicon_cisco.ico" />
<meta name="application-name" content="&nbsp;"/>
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="http://localhost:4000/images/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="http://localhost:4000/images/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="http://localhost:4000/images/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="http://localhost:4000/images/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="http://localhost:4000/images/mstile-310x310.png" />


<!-- end custom head snippets -->

  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/">Telemetry</a></li>
          
            
            
                
                    <li class="masthead__menu-item"><a href="https://xrdocs.github.io">@xrdocs</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="http://localhost:4000/blogs/">Blogs</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item greedy-nav-active"><a href="http://localhost:4000/tutorials/">Tutorials</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="http://localhost:4000/search">Search <i class="fa fa-search" aria-hidden="true"></i></a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="http://localhost:4000/tags/">Tags</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="http://localhost:4000/collection-archive/">Archive</a></li>
                
            


          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    




<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="http://localhost:4000/images/marumer_bio.png" class="author__avatar" alt="Marco Umer">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Marco Umer</h3>
    <p class="author__bio">Technology, martial arts and nature are my passions</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
      
      
        <li><a href="mailto:marumer@cisco.com"><i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
      
      
      
      
      
      
      
      
      
      
      
        <li><a href="http://github.com/marumer"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Configuring Model-Driven Telemetry (MDT) with YDK and XR Native YANG model">
    <meta itemprop="description" content="Configuring Model-Driven Telemetry with YDK and XR Native YANG model">
    <meta itemprop="datePublished" content="October 24, 2016">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Configuring Model-Driven Telemetry (MDT) with YDK and XR Native YANG model
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  7 minutes read
</p>
          
        </header>
      

    


      <section class="page__content" itemprop="text">

        <aside class="sidebar__right">
<nav class="toc">
    <header><h4 class="nav__title"><i class="fa fa-table"></i> Configuring MDT with YDK + XR native YANG</h4></header>
<ul class="toc__menu" id="markdown-toc">
  <li><a href="#getting-a-complete-mdt-configuration-with-native-yang-and-ydk" id="markdown-toc-getting-a-complete-mdt-configuration-with-native-yang-and-ydk">Getting a complete MDT configuration with Native YANG and YDK</a></li>
  <li><a href="#tutorial-goal" id="markdown-toc-tutorial-goal">Tutorial goal</a></li>
  <li><a href="#connect-to-the-router-and-import-ydks-libraries" id="markdown-toc-connect-to-the-router-and-import-ydks-libraries">Connect to the router and import YDK’s libraries</a></li>
  <li><a href="#define-and-apply-the-destination-group" id="markdown-toc-define-and-apply-the-destination-group">Define and apply the destination group</a></li>
  <li><a href="#define-and-apply-the-sensor-group" id="markdown-toc-define-and-apply-the-sensor-group">Define and apply the sensor group</a></li>
  <li><a href="#define-and-apply-the-subcription" id="markdown-toc-define-and-apply-the-subcription">Define and apply the subcription</a></li>
  <li><a href="#clean" id="markdown-toc-clean">Clean</a></li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>

  </nav>
</aside>

<h2 id="getting-a-complete-mdt-configuration-with-native-yang-and-ydk">Getting a complete MDT configuration with Native YANG and YDK</h2>

<p>In an <a href="https://xrdocs.github.io/telemetry/tutorials/2016-08-08-configuring-model-driven-telemetry-with-ydk/">earlier tutorial</a>, Shelly introduces a methodology to configure MDT using YDK and the OpenConfig Telemetry YANG model.</p>

<p>This document provides a similar tutorial, addressing a complete XR Telemetry TCP dial-out configuration using the native YANG model and YDK.</p>

<p>I have tested the configuration in this document using the relative recent Vagrant IOS-XRv box version 6.2.1.15I.
If you are looking for more information on IOS-XRv for Vagrant, you may follow Akshat tutorial <a href="https://xrdocs.github.io/application-hosting/tutorials/iosxr-vagrant-quickstart">IOS-XRv Vagrant Quick Start</a> for step by step instructions.</p>

<p>I have also used the <a href="https://github.com/CiscoDevNet/ydk-py">ydk-py version 0.5.1</a> and after installing YDK, you can check <code class="highlighter-rouge">ydk-models-cisco-ios-xr</code> current support for XR 6.1.1 using <code class="highlighter-rouge">pip list</code> command.</p>

<div class="notice--info">

<p>CLI Output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>(ydk-py) vagrant@vagrant-ubuntu-trusty-64:~/yang$ pip list
&lt;SNIP&gt;
ydk (0.5.1)
ydk-models-cisco-ios-xr (6.1.1)
ydk-models-ietf (0.1.1)
ydk-models-openconfig (0.1.1)
</code></pre>
</div>


</div>

<p>If you are not familiar with IOS-XRv, follow Akshat tutorial <a href="https://xrdocs.github.io/application-hosting/tutorials/iosxr-vagrant-quickstart">IOS-XRv Vagrant Quick Start</a> for step by step instructions.</p>

<h2 id="tutorial-goal">Tutorial goal</h2>

<p>By the end of this tutorial, you will have implemented the following configuration using YDK on the router under testing. If you are unfamiliar with the configuration just check the following tutorial <a href="https://xrdocs.github.io/telemetry/tutorials/2016-07-21-configuring-model-driven-telemetry-mdt/">Configuring Model-Driven Telemetry (MDT)</a></p>

<div class="notice--warning">

<p>CLI Output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>test_XR#show running-config telemetry model-driven 
Fri Oct 21 06:51:06.926 UTC
telemetry model-driven
 destination-group DG_Test
  address family ipv4 192.168.10.3 port 5432
   encoding self-describing-gpb
   protocol tcp
  !
 !
 sensor-group SG_Test
  sensor-path Cisco-IOS-XR-infra-statsd-oper:infra-statistics/interfaces/interface/latest/generic-counters
 !
 subscription 1
  sensor-group-id SG_Test sample-interval 30000
  destination-id DG_Test
 !
!
</code></pre>
</div>


</div>

<h2 id="connect-to-the-router-and-import-ydks-libraries">Connect to the router and import YDK’s libraries</h2>

<p>As described in previous YDK tutorials, we are importing the YDK Netconf library to communicate with the router.<br />
We also import the CRUDService YDK’s library (taking care of create, read, update and delete YDK objects from the router) and the IOS_XR native YDK model.<br />
The Empty type that we import from ydk.types has a special purpose later in the document to signal with its presence, the request to activate the submitted subscription.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">ydk.providers</span> <span class="kn">import</span> <span class="n">NetconfServiceProvider</span> 
<span class="kn">from</span> <span class="nn">ydk.services</span> <span class="kn">import</span> <span class="n">CRUDService</span>
<span class="kn">from</span> <span class="nn">ydk.types</span> <span class="kn">import</span> <span class="n">Empty</span> 
<span class="kn">import</span> <span class="nn">ydk.models.cisco_ios_xr.Cisco_IOS_XR_telemetry_model_driven_cfg</span> <span class="kn">as</span> <span class="nn">xr_telemetry</span>

<span class="n">HOST</span> <span class="o">=</span> <span class="s">'192.168.10.2'</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="mi">830</span>
<span class="n">USER</span> <span class="o">=</span> <span class="s">'vagrant'</span>
<span class="n">PASS</span> <span class="o">=</span> <span class="s">'vagrant'</span>

<span class="n">xr</span> <span class="o">=</span> <span class="n">NetconfServiceProvider</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">HOST</span><span class="p">,</span>
	<span class="n">port</span><span class="o">=</span><span class="n">PORT</span><span class="p">,</span>
	<span class="n">username</span><span class="o">=</span><span class="n">USER</span><span class="p">,</span>
	<span class="n">password</span><span class="o">=</span><span class="n">PASS</span><span class="p">,</span>
	<span class="n">protocol</span> <span class="o">=</span> <span class="s">'ssh'</span><span class="p">)</span>
</code></pre>
</div>

<p>With that, we are now connected to the router:</p>

<div class="notice--info">

<p>CLI Output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>RP/0/RP0/CPU0:test_XR#show netconf-yang clients 
Fri Oct 21 01:36:02.850 UTC
Netconf clients
client session ID|     NC version|    client connect time|        last OP time|        last OP type|    &lt;lock&gt;|
       4261169968|            1.1|         0d  0h  0m 28s|                    |                    |        No|
RP/0/RP0/CPU0:test_XR#

</code></pre>
</div>


</div>

<h2 id="define-and-apply-the-destination-group">Define and apply the destination group</h2>

<p>To access the native XR telemetry YANG model used in this tutorial (Cisco-IOS-XR-telemetry-model-driven-cfg.yang) use the <a href="https://github.com/YangModels/yang/tree/master/vendor/cisco/xr">YANG public repository</a>.<br />
Explore this same repository to see the other vendors and standard model YANGs but just in case you are looking for the OpenConfig, you will have to use <a href="https://github.com/openconfig/public">YANG OpenConfig repository</a>.</p>

<p>To explore the telemetry YANG model read directly the yang file or for example, follow a friendlier  tree that the Pyang utility generates.<br />
Note: if you have installed the YDK environment, you can use Pyang from this environment as <code class="highlighter-rouge">pyang -f tree Cisco-IOS-XR-telemetry-model-driven-cfg.yang</code></p>

<div class="notice--warning">

<p>PYANG output for the destination-groups:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>module: Cisco-IOS-XR-telemetry-model-driven-cfg
   +--rw telemetry-model-driven
      &lt;SNIP&gt;
      +--rw destination-groups
      |  +--rw destination-group* [destination-id]
      |     +--rw destinations
      |     |  +--rw destination* [address-family]
      |     |     +--rw address-family    Af
      |     |     +--rw ipv4* [ipv4-address destination-port]
      |     |     |  +--rw ipv4-address        inet:ip-address-no-zone
      |     |     |  +--rw destination-port    xr:Cisco-ios-xr-port-number
      |     |     |  +--rw protocol!
      |     |     |  |  +--rw protocol        Proto-type
      |     |     |  |  +--rw tls-hostname?   string
      |     |     |  |  +--rw no-tls?         int32
      |     |     |  +--rw encoding?           Encode-type
      |     |     +--rw ipv6* [ipv6-address destination-port]
      |     |        +--rw ipv6-address        xr:Cisco-ios-xr-string
      |     |        +--rw destination-port    xr:Cisco-ios-xr-port-number
      |     |        +--rw protocol!
      |     |        |  +--rw protocol        Proto-type
      |     |        |  +--rw tls-hostname?   string
      |     |        |  +--rw no-tls?         int32
      |     |        +--rw encoding?           Encode-type
      |     +--rw destination-id    xr:Cisco-ios-xr-string
      

</code></pre>
</div>

</div>

<p>The current <a href="https://developer.cisco.com/media/ydk-py-0.4.1/docs_expanded/index.html">Devnet’s documentation for YDK API</a> doesn’t include XR native telemetry YANG because it shows 0.4.1 content. I have honestly checked the syntax for my Python code accessing directly the <code class="highlighter-rouge">Cisco_IOS_XR_telemetry_model_driven_cfg.py</code> YDK model. 
Remember that you can use pip’s commands to find YDK’s modules <code class="highlighter-rouge">Location</code> that may vary by installation:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pip list
&lt;SNIP&gt;
pip show ydk-models-cisco-ios-xr
(ydk-py) vagrant@vagrant-ubuntu-trusty-64:~$ pip show ydk-models-cisco-ios-xr
---
Metadata-Version: 2.0
Name: ydk-models-cisco-ios-xr
Version: 6.1.1
Summary: YDK Python SDK
Home-page: https://github.com/CiscoDevNet/ydk-py
Author: Cisco Systems
Author-email: yang-dk@cisco.com
Installer: pip
License: Apache 2.0
Location: /home/vagrant/ydk-py/lib/python2.7/site-packages
Requires: paramiko, protobuf, lxml, ydk-models-openconfig, pycrypto, pyang, ydk-models-ietf, enum34, ecdsa, ncclient, ydk, Twisted
Classifiers:
  Development Status :: 3 - Alpha
  Intended Audience :: Developers
  Topic :: Software Development :: Build Tools
  License :: OSI Approved :: Apache 2.0 License
  Programming Language :: Python :: 2.7

</code></pre>
</div>
<p>With the location of the python modules you can access <code class="highlighter-rouge">Cisco_IOS_XR_telemetry_model_driven_cfg.py</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd /home/vagrant/ydk-py/lib/python2.7/site-packages
cd ydk/models/cisco_ios_xr
cat Cisco_IOS_XR_telemetry_model_driven_cfg.py

</code></pre>
</div>

<p>This is what the YANG model maps to YDK code for our example:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">dgroup</span><span class="o">=</span><span class="n">xr_telemetry</span><span class="o">.</span><span class="n">TelemetryModelDriven</span><span class="o">.</span><span class="n">DestinationGroups</span><span class="o">.</span><span class="n">DestinationGroup</span><span class="p">()</span>
<span class="n">dgroup</span><span class="o">.</span><span class="n">destination_id</span><span class="o">=</span><span class="s">"DG_Test"</span>
<span class="n">dgroup</span><span class="o">.</span><span class="n">destinations</span><span class="o">=</span><span class="n">dgroup</span><span class="o">.</span><span class="n">Destinations</span><span class="p">()</span>

<span class="n">new_destination</span><span class="o">=</span><span class="n">dgroup</span><span class="o">.</span><span class="n">Destinations</span><span class="o">.</span><span class="n">Destination</span><span class="p">()</span>
<span class="n">new_destination</span><span class="o">.</span><span class="n">address_family</span><span class="o">=</span><span class="n">xr_telemetry</span><span class="o">.</span><span class="n">AfEnum</span><span class="o">.</span><span class="n">IPV4</span>

<span class="n">new_ipv4</span><span class="o">=</span><span class="n">xr_telemetry</span><span class="o">.</span><span class="n">TelemetryModelDriven</span><span class="o">.</span><span class="n">DestinationGroups</span><span class="o">.</span><span class="n">DestinationGroup</span><span class="p">()</span><span class="o">.</span><span class="n">Destinations</span><span class="p">()</span><span class="o">.</span><span class="n">Destination</span><span class="p">()</span><span class="o">.</span><span class="n">Ipv4</span><span class="p">()</span>
<span class="n">new_ipv4</span><span class="o">.</span><span class="n">destination_port</span><span class="o">=</span><span class="mi">5432</span>
<span class="n">new_ipv4</span><span class="o">.</span><span class="n">ipv4_address</span><span class="o">=</span><span class="s">"192.168.10.3"</span>
<span class="n">new_ipv4</span><span class="o">.</span><span class="n">encoding</span><span class="o">=</span><span class="n">xr_telemetry</span><span class="o">.</span><span class="n">EncodeTypeEnum</span><span class="o">.</span><span class="n">SELF_DESCRIBING_GPB</span>
<span class="n">new_ipv4</span><span class="o">.</span><span class="n">protocol</span><span class="o">=</span><span class="n">xr_telemetry</span><span class="o">.</span><span class="n">TelemetryModelDriven</span><span class="o">.</span><span class="n">DestinationGroups</span><span class="o">.</span><span class="n">DestinationGroup</span><span class="p">()</span><span class="o">.</span><span class="n">Destinations</span><span class="p">()</span><span class="o">.</span><span class="n">Destination</span><span class="p">()</span><span class="o">.</span><span class="n">Ipv4</span><span class="p">()</span><span class="o">.</span><span class="n">Protocol</span><span class="p">()</span>
<span class="n">new_ipv4</span><span class="o">.</span><span class="n">protocol</span><span class="o">.</span><span class="n">protocol</span><span class="o">=</span><span class="n">xr_telemetry</span><span class="o">.</span><span class="n">ProtoTypeEnum</span><span class="o">.</span><span class="n">TCP</span>
<span class="n">new_destination</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_ipv4</span><span class="p">)</span>
<span class="n">dgroup</span><span class="o">.</span><span class="n">destinations</span><span class="o">.</span><span class="n">destination</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_destination</span><span class="p">)</span>

</code></pre>
</div>

<p>Once you’ve populated the object, we can apply it to the router using the create method on the CRUDService object from YDK:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">rpc_service</span> <span class="o">=</span> <span class="n">CRUDService</span><span class="p">()</span>
<span class="n">rpc_service</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">xr</span><span class="p">,</span> <span class="n">dgroup</span><span class="p">)</span>
</code></pre>
</div>

<p>And here is the expected CLI output with the destination group describing where and how to steam:</p>

<div class="notice--info">

<p>CLI Output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>RP/0/RP0/CPU0:test_XR#sh running-config telemetry model-driven 
Fri Oct 21 06:35:06.731 UTC
telemetry model-driven
 destination-group DG_Test
  address family ipv4 192.168.10.3 port 5432
   encoding self-describing-gpb
   protocol tcp
  !
 !
!
</code></pre>
</div>


</div>

<h2 id="define-and-apply-the-sensor-group">Define and apply the sensor group</h2>

<p>As for the destination group, this is the section of the YANG model for the sensor group:</p>

<div class="notice--warning">

<p>PYANG output for the sensor-groups:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>module: Cisco-IOS-XR-telemetry-model-driven-cfg
  +--rw telemetry-model-driven
	  +--rw sensor-groups
      |  +--rw sensor-group* [sensor-group-identifier]
      |     +--rw sensor-paths
      |     |  +--rw sensor-path* [telemetry-sensor-path]
      |     |     +--rw telemetry-sensor-path    string
      |     +--rw enable?                    empty
      |     +--rw sensor-group-identifier    xr:Cisco-ios-xr-string
	&lt;SNIP&gt;
  
</code></pre>
</div>

</div>

<p>… and the YDK code that it maps to:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">sgroup</span> <span class="o">=</span> <span class="n">xr_telemetry</span><span class="o">.</span><span class="n">TelemetryModelDriven</span><span class="o">.</span><span class="n">SensorGroups</span><span class="o">.</span><span class="n">SensorGroup</span><span class="p">()</span>
<span class="n">sgroup</span><span class="o">.</span><span class="n">sensor_group_identifier</span><span class="o">=</span><span class="s">"SG_Test"</span>

<span class="n">sgroup</span><span class="o">.</span><span class="n">sensor_paths</span> <span class="o">=</span> <span class="n">sgroup</span><span class="o">.</span><span class="n">SensorPaths</span><span class="p">()</span>
<span class="n">new_sensorpath</span> <span class="o">=</span> <span class="n">sgroup</span><span class="o">.</span><span class="n">SensorPaths</span><span class="o">.</span><span class="n">SensorPath</span><span class="p">()</span>
<span class="n">new_sensorpath</span><span class="o">.</span><span class="n">telemetry_sensor_path</span> <span class="o">=</span> <span class="s">'Cisco-IOS-XR-infra-statsd-oper:infra-statistics/interfaces/interface/latest/generic-counters'</span>
<span class="n">sgroup</span><span class="o">.</span><span class="n">sensor_paths</span><span class="o">.</span><span class="n">sensor_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_sensorpath</span><span class="p">)</span>
</code></pre>
</div>

<p>Now we are ready to submit the sensor group object just populated with the same <code class="highlighter-rouge">create</code> method from the CRUDService object:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code>
<span class="n">rpc_service</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">xr</span><span class="p">,</span> <span class="n">sgroup</span><span class="p">)</span>

</code></pre>
</div>

<p>Note: you need to initialize the rpc_service as <code class="highlighter-rouge">rpc_service = CRUDService()</code> a single time.<br />
If you remember, we have already done it when creating the destination group but if you skipped the previous step, add it before requesting to create for the sensor group.</p>

<p>Let’s check the CLI running-configuration again. You should now find the destination (from the previous step) and sensor group just created in place:</p>

<div class="notice--info">

<p>CLI Output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>RP/0/RP0/CPU0:test_XR#show running-config telemetry model-driven 
Fri Oct 21 06:45:58.444 UTC
telemetry model-driven
 destination-group DG_Test
  address family ipv4 192.168.10.3 port 5432
   encoding self-describing-gpb
   protocol tcp
  !
 !
 sensor-group SG_Test
  sensor-path Cisco-IOS-XR-infra-statsd-oper:infra-statistics/interfaces/interface/latest/generic-counters
 !
!
</code></pre>
</div>


</div>

<h2 id="define-and-apply-the-subcription">Define and apply the subcription</h2>

<p>The final step in our configration is the subcription.</p>

<div class="notice--warning">

<p>PYANG output for the subcription:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>module: Cisco-IOS-XR-telemetry-model-driven-cfg
  +--rw telemetry-model-driven
	&lt;SNIP&gt;
      +--rw subscriptions
      |  +--rw subscription* [subscription-identifier]
      |     +--rw source-address!
      |     |  +--rw address-family    Af
      |     |  +--rw ip-address?       inet:ipv4-address-no-zone
      |     |  +--rw ipv6-address?     string
      |     +--rw sensor-profiles
      |     |  +--rw sensor-profile* [sensorgroupid]
      |     |     +--rw sample-interval?      uint32
      |     |     +--rw heartbeat-interval?   uint32
      |     |     +--rw supress-redundant?    empty
      |     |     +--rw sensorgroupid         xr:Cisco-ios-xr-string
      |     +--rw destination-profiles
      |     |  +--rw destination-profile* [destination-id]
      |     |     +--rw enable?           empty
      |     |     +--rw destination-id    xr:Cisco-ios-xr-string
      |     +--rw source-qos-marking?        uint32
      |     +--rw subscription-identifier    xr:Cisco-ios-xr-string

	&lt;SNIP&gt;
  
</code></pre>
</div>

</div>

<p>This is how that ends up in YDK code:</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">sub</span> <span class="o">=</span> <span class="n">xr_telemetry</span><span class="o">.</span><span class="n">TelemetryModelDriven</span><span class="o">.</span><span class="n">Subscriptions</span><span class="o">.</span><span class="n">Subscription</span><span class="p">()</span>
<span class="n">sub</span><span class="o">.</span><span class="n">subscription_identifier</span> <span class="o">=</span> <span class="s">"1"</span>

<span class="n">sub</span><span class="o">.</span><span class="n">sensor_profiles</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">SensorProfiles</span><span class="p">()</span>
<span class="n">sub</span><span class="o">.</span><span class="n">destination_profiles</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">DestinationProfiles</span><span class="p">()</span>
                               
<span class="n">new_sprofile</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">SensorProfiles</span><span class="o">.</span><span class="n">SensorProfile</span><span class="p">()</span>
<span class="n">new_sprofile</span><span class="o">.</span><span class="n">sensorgroupid</span> <span class="o">=</span> <span class="s">'SG_Test'</span>
<span class="n">new_sprofile</span><span class="o">.</span><span class="n">sample_interval</span> <span class="o">=</span> <span class="mi">30000</span>

<span class="n">new_dprofile</span> <span class="o">=</span> <span class="n">sub</span><span class="o">.</span><span class="n">DestinationProfiles</span><span class="o">.</span><span class="n">DestinationProfile</span><span class="p">()</span>
<span class="n">new_dprofile</span><span class="o">.</span><span class="n">destination_id</span><span class="o">=</span><span class="s">"DG_Test"</span>
<span class="n">new_dprofile</span><span class="o">.</span><span class="n">enable</span><span class="o">=</span><span class="n">Empty</span><span class="p">()</span>

<span class="n">sub</span><span class="o">.</span><span class="n">sensor_profiles</span><span class="o">.</span><span class="n">sensor_profile</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_sprofile</span><span class="p">)</span>
<span class="n">sub</span><span class="o">.</span><span class="n">destination_profiles</span><span class="o">.</span><span class="n">destination_profile</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_dprofile</span><span class="p">)</span>
</code></pre>
</div>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">rpc_service</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">xr</span><span class="p">,</span> <span class="n">sub</span><span class="p">)</span>
</code></pre>
</div>

<p>If you check your router running-configuration, you should now have a complete TCP dial-out telemetry configuration  as:</p>

<div class="notice--info">

<p>CLI Output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>P/0/RP0/CPU0:test_XR#show running-config telemetry model-driven 
Fri Oct 21 06:51:06.926 UTC
telemetry model-driven
 destination-group DG_Test
  address family ipv4 192.168.10.3 port 5432
   encoding self-describing-gpb
   protocol tcp
  !
 !
 sensor-group SG_Test
  sensor-path Cisco-IOS-XR-infra-statsd-oper:infra-statistics/interfaces/interface/latest/generic-counters
 !
 subscription 1
  sensor-group-id SG_Test sample-interval 30000
  destination-id DG_Test
 !
!
</code></pre>
</div>


</div>

<h2 id="clean">Clean</h2>

<p>Two last commands to delete the configuration just submitted and disconnect the Netconf session.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">rpc_service</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">xr</span><span class="p">,</span> <span class="n">xr_telemetry</span><span class="o">.</span><span class="n">TelemetryModelDriven</span><span class="p">())</span>
<span class="n">xr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre>
</div>
<p>And confirm in the router’s ‘show running-config’</p>

<div class="notice--info">

<p>CLI Output:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>RP/0/RP0/CPU0:test_XR#show running-config telemetry model-driven 
Fri Oct 21 06:59:46.743 UTC
% No such configuration item(s)

RP/0/RP0/CPU0:test_XR#

</code></pre>
</div>


</div>

<h2 id="conclusion">Conclusion</h2>

<p>This tutorial complements the concepts explained by Shelly in her <a href="https://xrdocs.github.io/telemetry/tutorials/2016-08-08-configuring-model-driven-telemetry-with-ydk/">earlier tutorial</a>. 
The same values in programmability using YANG models, automatic generation of Python classes that inherit the syntactic checks and requirements of the underlying model, while also handling all the details for the sensor group using the native telemetry YANG model.</p>


        
      </section>

      <footer class="page__meta">
        
        




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://localhost:4000/tags/#iosxr" class="page__taxonomy-item" rel="tag">iosxr</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#telemetry" class="page__taxonomy-item" rel="tag">Telemetry</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#yang" class="page__taxonomy-item" rel="tag">YANG</a><span class="sep">, </span>
    
      
      
      <a href="http://localhost:4000/tags/#ydk" class="page__taxonomy-item" rel="tag">YDK</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-10-24T05:39:00+00:00">October 24, 2016</time></p>
        
      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/tutorials/2016-10-24-configuring-model-driven-telemetry-mdt-with-ydk-and-xr-native-yang-model/" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/tutorials/2016-10-24-configuring-model-driven-telemetry-mdt-with-ydk-and-xr-native-yang-model/" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http://localhost:4000/tutorials/2016-10-24-configuring-model-driven-telemetry-mdt-with-ydk-and-xr-native-yang-model/" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://localhost:4000/tutorials/2016-10-24-configuring-model-driven-telemetry-mdt-with-ydk-and-xr-native-yang-model/" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>

    <br>
    <br>
    <br>
</section>


    </div>

    
      

<div class="page__comments">
  <h4 class="page__comments-title">Leave a Comment</h4>
  
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/xrdocs"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/xrdocs"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2017 Cisco Systems Inc. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>
<script src="http://localhost:4000/assets/js/scrollmenu.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78256516-1', 'auto');
  ga('send', 'pageview');
</script>






  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'xrdocs';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






<!-- material-scrolltop button -->
<button class="material-scrolltop" type="button"></button>

<!-- material-scrolltop plugin -->
<script src="http://localhost:4000/assets/js/material-scrolltop.js"></script>

<!-- Initialize material-scrolltop with (minimal) -->
<script>
    $('body').materialScrollTop();
</script>


  </body>
</html>

